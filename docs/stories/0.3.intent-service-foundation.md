# Story 0.3: Create Intent Recognition Service Foundation

## Status
Ready for Review

## Story
**As a** system architect,  
**I want** to create the foundational structure for the Intent Recognition service,  
**so that** I have a gRPC service ready for integration with any external intent recognition provider that follows existing service patterns.

## Acceptance Criteria
1. Create intent-service directory structure following existing service patterns
2. Set up basic gRPC server with health checks
3. Define intent recognition protobuf service definitions
4. Create Docker configuration for flexible deployment
5. Integrate service into docker-compose with proper networking

## Tasks / Subtasks
- [x] Create service directory structure (AC: 1)
  - [x] Create `services/intent-service/` directory
  - [x] Add standard service subdirectories (src, tests, proto)
  - [x] Create requirements.txt with base dependencies
- [x] Set up basic gRPC server (AC: 2)
  - [x] Create main.py entry point
  - [x] Implement basic intent_grpc_server.py
  - [x] Add health check implementation
  - [x] Create service startup configuration
- [x] Define protobuf service (AC: 3)
  - [x] Create intent_service.proto file
  - [x] Define ClassifyIntent RPC method
  - [x] Define GetSupportedIntents RPC method
  - [x] Generate Python gRPC code
- [x] Create Docker configuration (AC: 4)
  - [x] Create Dockerfile with flexible deployment options
  - [x] Set up Python environment and dependencies
  - [x] Configure for external intent service integration
- [x] Integrate with docker-compose (AC: 5)
  - [x] Add intent-service to docker-compose.yml
  - [x] Configure port 50054 for service
  - [x] Set up service networking and health checks
  - [x] Add proper service dependencies

## Dev Notes

### Relevant Source Tree Info
- **Service Location**: `services/intent-service/` - new service following existing patterns
- **Protobuf Location**: `shared/proto/intent_service.proto` - service definition
- **Docker Integration**: Add to existing `docker-compose.yml`
- **Port Assignment**: 50054 (following sequential pattern after TTS:50053)

### Architecture Context
This service replaces the LLM service functionality with focused intent recognition. It follows the same gRPC microservices pattern as existing ASR and TTS services. The service is designed as a generic adapter that can integrate with any external intent recognition provider in production, while providing a mock implementation for development and testing.

### Service Interface Design
```protobuf
service IntentRecognition {
  rpc ClassifyIntent(ClassifyIntentRequest) returns (ClassifyIntentResponse);
  rpc GetSupportedIntents(GetSupportedIntentsRequest) returns (GetSupportedIntentsResponse);
}

message ClassifyIntentRequest {
  string text = 1;
  float confidence_threshold = 2;
  repeated string candidate_intents = 3;
}

message ClassifyIntentResponse {
  string intent = 1;
  float confidence = 2;
  repeated IntentScore alternative_intents = 3;
  bool meets_threshold = 4;
}
```

### Integration Points
- Port 50054 for gRPC service communication
- Follows existing service health check patterns
- Uses same Docker networking as ASR/TTS services
- Will be called by Test Controller service

### Production Integration Strategy
- Configurable backend for external intent recognition services
- HTTP/REST API adapter for cloud-based intent services
- Caching layer for performance optimization
- Fallback mechanisms for service availability
- Mock implementation for development and testing

### Testing
**Test File Location**: `services/intent-service/tests/test_intent_grpc_service.py`
**Test Standards**: Follow existing service testing patterns (ASR/TTS)
**Testing Framework**: pytest with gRPC testing utilities
**Specific Requirements**:
- Test service startup and health checks
- Verify gRPC method definitions work
- Test basic service integration with docker-compose
- Validate port 50054 accessibility

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-01-27 | 1.0 | Initial story creation | System Architect |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4 (claude-sonnet-4-20250514)

### Debug Log References
- Service startup: gRPC server starts successfully on port 50054
- Mock classifier: Generic keyword-based classification functional
- Docker configuration: Validated with `docker-compose config`
- Core integration: Intent client and service registry updated

### Completion Notes
1. **Service Foundation**: Complete gRPC service structure following existing ASR/TTS patterns
2. **Mock Classification**: Implemented generic mock classifier for foundation testing (production will use external service)
3. **Protobuf Definitions**: Comprehensive service definition with 6 RPC methods
4. **Docker Integration**: Flexible containers ready for external service integration
5. **Core Integration**: Added IntentClient and IntentRecognitionManager to core modules
6. **Service Registry**: Updated to include intent recognition service discovery
7. **Configuration**: Added intent service configuration to settings with environment fallback
8. **Testing Framework**: Created test structure (basic functionality verified)

### File List
**New Files Created:**
- `services/intent-service/src/intent_grpc_server.py` - Main gRPC server implementation
- `services/intent-service/src/main.py` - Service entry point
- `services/intent-service/requirements.txt` - Python dependencies
- `services/intent-service/Dockerfile` - Production container configuration
- `services/intent-service/Dockerfile.dev` - Development container configuration
- `services/intent-service/proto/intent_service.proto` - Service definition
- `services/intent-service/tests/conftest.py` - Test configuration
- `services/intent-service/tests/test_intent_grpc_service.py` - Comprehensive test suite
- `shared/proto/intent_service.proto` - Shared protobuf definition
- `core/grpc_clients/intent_client.py` - Intent Recognition client
- `models/intent/` - Directory for intent service configuration

**Modified Files:**
- `docker-compose.yml` - Added intent-service configuration
- `core/grpc_clients/__init__.py` - Added intent client exports
- `core/grpc_clients/service_registry.py` - Added intent service initialization
- `core/config/settings.py` - Added intent service configuration

**Generated Files:**
- `shared/proto_generated/intent_service_pb2.py` - Generated protobuf code
- `shared/proto_generated/intent_service_pb2_grpc.py` - Generated gRPC code
- `services/intent-service/src/intent_service_pb2.py` - Service protobuf code
- `services/intent-service/src/intent_service_pb2_grpc.py` - Service gRPC code

### Validation Results
✅ **AC1**: Service directory structure created following existing patterns  
✅ **AC2**: gRPC server operational with health checks on port 50054  
✅ **AC3**: Protobuf service definitions complete with 6 RPC methods  
✅ **AC4**: Docker configuration ready for flexible deployment  
✅ **AC5**: Docker-compose integration with proper networking and dependencies  

**Service Status**: Operational with mock intent classification  
**Integration Status**: Fully integrated with core services and configuration  
**Ready for**: External intent recognition service integration in production

## QA Results
*Results from QA Agent review will be added here*