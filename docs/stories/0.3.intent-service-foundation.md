# Story 0.3: Create Intent Recognition Service Foundation

## Status
Draft

## Story
**As a** system architect,  
**I want** to create the foundational structure for the Intent Recognition service,  
**so that** I have a gRPC service ready for Turkish BERT integration that follows existing service patterns.

## Acceptance Criteria
1. Create intent-service directory structure following existing service patterns
2. Set up basic gRPC server with health checks
3. Define intent recognition protobuf service definitions
4. Create Docker configuration for CPU-optimized deployment
5. Integrate service into docker-compose with proper networking

## Tasks / Subtasks
- [ ] Create service directory structure (AC: 1)
  - [ ] Create `services/intent-service/` directory
  - [ ] Add standard service subdirectories (src, tests, proto)
  - [ ] Create requirements.txt with base dependencies
- [ ] Set up basic gRPC server (AC: 2)
  - [ ] Create main.py entry point
  - [ ] Implement basic intent_grpc_server.py
  - [ ] Add health check implementation
  - [ ] Create service startup configuration
- [ ] Define protobuf service (AC: 3)
  - [ ] Create intent_service.proto file
  - [ ] Define ClassifyIntent RPC method
  - [ ] Define GetSupportedIntents RPC method
  - [ ] Generate Python gRPC code
- [ ] Create Docker configuration (AC: 4)
  - [ ] Create Dockerfile with CPU optimization
  - [ ] Set up Python environment and dependencies
  - [ ] Configure for Turkish BERT model loading
- [ ] Integrate with docker-compose (AC: 5)
  - [ ] Add intent-service to docker-compose.yml
  - [ ] Configure port 50054 for service
  - [ ] Set up service networking and health checks
  - [ ] Add proper service dependencies

## Dev Notes

### Relevant Source Tree Info
- **Service Location**: `services/intent-service/` - new service following existing patterns
- **Protobuf Location**: `shared/proto/intent_service.proto` - service definition
- **Docker Integration**: Add to existing `docker-compose.yml`
- **Port Assignment**: 50054 (following sequential pattern after TTS:50053)

### Architecture Context
This service replaces the LLM service functionality with focused intent recognition. It follows the same gRPC microservices pattern as existing ASR and TTS services. The service is designed for CPU-only deployment and will use Turkish BERT for classification in Epic 2.1.

### Service Interface Design
```protobuf
service IntentRecognition {
  rpc ClassifyIntent(ClassifyIntentRequest) returns (ClassifyIntentResponse);
  rpc GetSupportedIntents(GetSupportedIntentsRequest) returns (GetSupportedIntentsResponse);
}

message ClassifyIntentRequest {
  string text = 1;
  float confidence_threshold = 2;
  repeated string candidate_intents = 3;
}

message ClassifyIntentResponse {
  string intent = 1;
  float confidence = 2;
  repeated IntentScore alternative_intents = 3;
  bool meets_threshold = 4;
}
```

### Integration Points
- Port 50054 for gRPC service communication
- Follows existing service health check patterns
- Uses same Docker networking as ASR/TTS services
- Will be called by Test Controller service

### CPU Optimization Strategy
- Use ONNX Runtime for Turkish BERT inference
- Multi-threading for concurrent classification requests
- Memory-efficient model loading and caching
- No GPU dependencies - pure CPU deployment

### Testing
**Test File Location**: `services/intent-service/tests/test_intent_grpc_service.py`
**Test Standards**: Follow existing service testing patterns (ASR/TTS)
**Testing Framework**: pytest with gRPC testing utilities
**Specific Requirements**:
- Test service startup and health checks
- Verify gRPC method definitions work
- Test basic service integration with docker-compose
- Validate port 50054 accessibility

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-01-27 | 1.0 | Initial story creation | System Architect |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

## QA Results
*Results from QA Agent review will be added here*