# Story 0.2: Setup SQLite Database Infrastructure

## Status
Draft

## Story
**As a** system architect,  
**I want** to set up SQLite database infrastructure for test data storage,  
**so that** I can store test scenarios, execution results, and intent training data for the IVR automation system.

## Acceptance Criteria
1. Create data directory structure for SQLite databases
2. Implement database schema for test scenarios and results
3. Create database initialization scripts
4. Set up database connection utilities
5. Configure Docker volume mounting for data persistence

## Tasks / Subtasks
- [ ] Create data directory structure (AC: 1)
  - [ ] Create `data/` directory in project root
  - [ ] Create subdirectories for databases, training data, results
  - [ ] Add appropriate .gitignore entries for database files
- [ ] Implement database schema (AC: 2)  
  - [ ] Create test_scenarios table schema
  - [ ] Create test_executions table schema
  - [ ] Create step_executions table schema
  - [ ] Create intent_training_data table schema
- [ ] Create database initialization (AC: 3)
  - [ ] Write database initialization script
  - [ ] Create sample test scenario data
  - [ ] Add database migration utilities
- [ ] Set up connection utilities (AC: 4)
  - [ ] Create database connection manager
  - [ ] Implement basic CRUD operations
  - [ ] Add connection pooling if needed
- [ ] Configure Docker persistence (AC: 5)
  - [ ] Add data volume mounts to docker-compose
  - [ ] Ensure database persistence across container restarts
  - [ ] Set proper file permissions for database access

## Dev Notes

### Relevant Source Tree Info
- **Data Directory**: `data/` - new directory for all test-related data
- **Database Location**: `data/test_scenarios.db` - main SQLite database
- **Training Data**: `data/training_data/` - intent recognition training data
- **Results Storage**: `data/test_results/` - test execution results and recordings
- **Utilities**: `core/utils/database.py` - new database utilities

### Architecture Context
Based on data models defined in architecture document, this story establishes the data storage foundation for all IVR testing functionality. SQLite is chosen for simplicity and no additional infrastructure requirements. Database schema follows the data models specified in the architecture document.

### Database Schema Design
```sql
-- Test scenarios with JSON steps
CREATE TABLE test_scenarios (
    scenario_id INTEGER PRIMARY KEY,
    name TEXT NOT NULL,
    description TEXT,
    target_phone TEXT NOT NULL,
    steps JSON,
    timeout_seconds INTEGER DEFAULT 300,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Test execution tracking
CREATE TABLE test_executions (
    execution_id INTEGER PRIMARY KEY,
    scenario_id INTEGER REFERENCES test_scenarios(scenario_id),
    status TEXT CHECK (status IN ('running', 'completed', 'failed', 'timeout')),
    start_time TIMESTAMP,
    end_time TIMESTAMP,
    call_id TEXT,
    final_result TEXT CHECK (final_result IN ('pass', 'fail')),
    error_message TEXT
);
```

### Integration Points
- Database will be accessed by Test Controller service (Epic 1.2)
- Intent training data will be used by Intent Recognition service (Epic 2.1)
- Web interface will query database for test management (Epic 3)

### Testing
**Test File Location**: `tests/test_database_setup.py`
**Test Standards**: pytest framework with SQLite testing patterns
**Testing Framework**: Use existing pytest configuration, add database fixtures
**Specific Requirements**:
- Test database creation and schema initialization
- Verify CRUD operations work correctly
- Test database persistence across container restarts
- Validate data integrity constraints

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-01-27 | 1.0 | Initial story creation | System Architect |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

## QA Results
*Results from QA Agent review will be added here*