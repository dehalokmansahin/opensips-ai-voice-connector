# Story 2.1: Turkish BERT Intent Recognition

## Status
Draft

## Story
**As a** test validator,  
**I want** intent recognition on transcribed IVR responses,  
**so that** I can validate expected behaviors.

## Acceptance Criteria
1. Turkish BERT model integration (dbmdz/bert-base-turkish-uncased)
2. Basic intent classification for common IVR responses
3. Pass/fail determination based on expected intents
4. Simple training data for IVR-specific responses

## Tasks / Subtasks
- [ ] Integrate Turkish BERT model (AC: 1)
  - [ ] Install transformers library and dependencies
  - [ ] Load dbmdz/bert-base-turkish-uncased model
  - [ ] Set up CPU-optimized inference with ONNX
  - [ ] Create model loading and caching system
- [ ] Implement intent classification (AC: 2)
  - [ ] Create text preprocessing for Turkish IVR responses
  - [ ] Implement classification inference pipeline
  - [ ] Define common IVR intent categories
  - [ ] Add confidence scoring for classifications
- [ ] Add pass/fail determination (AC: 3)
  - [ ] Create intent matching logic for test validation
  - [ ] Implement confidence threshold checking
  - [ ] Add test result determination logic
  - [ ] Create detailed classification reporting
- [ ] Set up training data management (AC: 4)
  - [ ] Create sample IVR response training data
  - [ ] Implement training data loading from SQLite
  - [ ] Add training data validation
  - [ ] Create training data management utilities

## Dev Notes

### Relevant Source Tree Info
- **Intent Service**: `services/intent-service/src/turkish_bert_engine.py` - BERT model integration
- **gRPC Server**: `services/intent-service/src/intent_grpc_server.py` - service interface
- **Training Data**: `data/training_data/turkish_ivr_intents.json` - IVR-specific training data
- **Model Cache**: `services/intent-service/models/` - cached model files
- **Requirements**: `services/intent-service/requirements.txt` - add transformers, onnxruntime

### Architecture Context
This story implements the core intelligence of the IVR testing system. Turkish BERT replaces the previous LLM service with focused intent classification. The service processes ASR transcripts and determines if IVR responses match expected intents for pass/fail test validation.

### Turkish BERT Model Integration
```python
# Model: dbmdz/bert-base-turkish-uncased
# Framework: Transformers + ONNX Runtime for CPU optimization
# Input: Text from ASR transcription
# Output: Intent classification with confidence score
```

### Common IVR Intent Categories
```python
COMMON_IVR_INTENTS = [
    "greeting",           # "Merhaba, bankamıza hoş geldiniz"
    "menu_options",       # "1 için hesap bilgileri, 2 için..."
    "invalid_option",     # "Geçersiz seçim, lütfen tekrar deneyin"
    "transfer_agent",     # "Müşteri temsilcisine aktarılıyorsunuz"
    "account_info",       # "Hesap bilgileriniz için..."
    "balance_inquiry",    # "Bakiye sorgulama için..."
    "goodbye",           # "İyi günler dileriz"
    "timeout_warning",   # "Yanıt bekleniyor..."
    "system_error"       # "Sistem hatası oluştu"
]
```

### CPU Optimization Strategy
- Use ONNX Runtime for faster CPU inference
- Implement model caching to avoid reload overhead
- Batch processing for multiple classification requests
- Memory-efficient tokenization and processing

### Training Data Format
```json
{
  "training_samples": [
    {
      "text": "Merhaba, Bankamıza hoş geldiniz",
      "intent": "greeting",
      "confidence_threshold": 0.85
    },
    {
      "text": "Hesap bilgileri için 1, kredi kartı için 2 tuşlayın",
      "intent": "menu_options", 
      "confidence_threshold": 0.80
    }
  ]
}
```

### Integration Points
- **Test Controller**: Receives classification requests via gRPC
- **ASR Service**: Text input from voice transcription
- **Database**: Training data and intent definitions
- **Test Validation**: Pass/fail determination based on expected vs actual intents

### gRPC Service Interface
```protobuf
service IntentRecognition {
  rpc ClassifyIntent(ClassifyIntentRequest) returns (ClassifyIntentResponse);
  rpc GetSupportedIntents(GetSupportedIntentsRequest) returns (GetSupportedIntentsResponse);
}
```

### Testing
**Test File Location**: `services/intent-service/tests/test_turkish_bert_engine.py`
**Test Standards**: Unit tests for model integration, classification accuracy tests
**Testing Framework**: pytest with transformers testing utilities
**Specific Requirements**:
- Test Turkish BERT model loading and inference
- Verify intent classification accuracy on sample data
- Test confidence threshold handling
- Validate CPU-only deployment works
- Test gRPC service integration

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-01-27 | 1.0 | Initial story creation | System Architect |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

## QA Results
*Results from QA Agent review will be added here*