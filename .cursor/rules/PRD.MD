
# ğŸš€ PRD â€“ Pipecat IVR Sanal Asistan (GeliÅŸtirici Dostu)

---

## 1. AmaÃ§

Bu dokÃ¼man, bir banka Ã§aÄŸrÄ± merkezi iÃ§in geliÅŸtirilecek olan **Pipecat tabanlÄ± gerÃ§ek zamanlÄ± sanal asistan** projesinin teknik gereksinimlerini ve Ã¼rÃ¼n tanÄ±mÄ±nÄ± iÃ§erir.

-   **Proje Hedefi:** Banka Ã§aÄŸrÄ± merkezi IVR (Interactive Voice Response) sistemini, modern ve akÄ±cÄ± bir diyalog deneyimi sunan bir sanal asistan ile gÃ¼Ã§lendirmek.
-   **Teknoloji OdaÄŸÄ±:** Proje, ses taÅŸÄ±ma katmanÄ± olarak OAVC (Open-Source Audio/Video Conferencing) platformunu kullanacak ve iÅŸ mantÄ±ÄŸÄ± **Pipecat pipeline**'Ä± Ã¼zerinde inÅŸa edilecektir.
-   **Pipeline BileÅŸenleri:**
    -   **VAD (Voice Activity Detection):** KullanÄ±cÄ±nÄ±n ne zaman konuÅŸup ne zaman sustuÄŸunu tespit ederek konuÅŸma segmentleri oluÅŸturma.
    -   **Interruption (Barge-in):** Sanal asistan konuÅŸurken kullanÄ±cÄ±nÄ±n araya girmesine (barge-in) olanak tanÄ±ma.
    -   **Ã‡ekirdek AkÄ±ÅŸ:** GerÃ§ek zamanlÄ± STT (Speech-to-Text) â†’ LLM (Large Language Model) â†’ TTS (Text-to-Speech) akÄ±ÅŸÄ±nÄ± yÃ¶netme.
-   **Ã–rnek Senaryo:** Projenin yeteneklerini sergilemek amacÄ±yla **"Kart Kurye Durumu Sorgulama"** akÄ±ÅŸÄ± pilot olarak geliÅŸtirilecektir.

---

## 2. AkÄ±ÅŸ (High Level)

Sistemin uÃ§tan uca veri akÄ±ÅŸÄ± aÅŸaÄŸÄ±daki gibi olacaktÄ±r:

> **OAVC (PCMU/8000 GiriÅŸi)** â†’ **PCMUâ†’PCM Decode** â†’ **Pipecat Pipeline** â†’ VAD â†’ STT â†’ LLM â†’ TTS â†’ **PCMâ†’PCMU Encode** â†’ **OAVC (PCMU/8000 Ã‡Ä±kÄ±ÅŸÄ±)**

---

## 3. Ses FormatÄ±

-   **GiriÅŸ (OAVC'den):** `PCMU/8000 ulaw` formatÄ± (8-bit, 8kHz, mono).
-   **Paketleme:** OAVC, RTP paketleri aracÄ±lÄ±ÄŸÄ±yla sesi yaklaÅŸÄ±k **20ms'lik parÃ§alar (chunk)** halinde iletir. Bu, `8000 (Ã¶rnek/sn) * 0.020 (sn) * 1 (byte/Ã¶rnek) = 160 byte/frame` boyutuna karÅŸÄ±lÄ±k gelir.
-   **Pipeline Ä°Ã§i Ä°ÅŸleme:** Gelen PCMU ses verisi pipeline iÃ§inde `PCM 16-bit, 16kHz, mono` formatÄ±na decode edilir.
-   **Ã‡Ä±kÄ±ÅŸ (Pipecat'ten):** TTS servisinden Ã¼retilen ses `PCM 22050kHz, mono` formatÄ±ndadÄ±r. Bu ses, PSTN (Public Switched Telephone Network) hatlarÄ±na gÃ¶nderilmeden Ã¶nce `PCMU/8000 ulaw` formatÄ±na **encode** edilmelidir.

**Format DÃ¶nÃ¼ÅŸÃ¼m AkÄ±ÅŸÄ±:**
> **PCMU/8000 (giriÅŸ)** â†’ **PCM 16kHz decode** â†’ **Pipeline Ä°ÅŸleme** â†’ **PCM 22050kHz (TTS)** â†’ **PCMU/8000 encode (Ã§Ä±kÄ±ÅŸ)**

---



## 5. OAVC PCMU Veri Ä°ÅŸleme

OAVC'den gelen her 20ms'lik RTP paketi, PCMU/8000 ulaw formatÄ±nda Pipecat pipeline'Ä±na gÃ¶nderilir.

-   **Ã–rnekleme HesabÄ±:** `0.020 saniye * 8000 Ã¶rnek/saniye = 160 Ã¶rnek`
-   **Byte Boyutu:** `160 Ã¶rnek * 1 byte/Ã¶rnek (8-bit ulaw) = 160 byte`



---
## 7. VAD Parametreleri

TÃ¼rkÃ§e konuÅŸma iÃ§in Ã¶nerilen baÅŸlangÄ±Ã§ VAD (Silero) parametreleri:

| Parametre | DeÄŸer | AÃ§Ä±klama |
| :--- | :---: | :--- |
| `min_speech_duration_ms` | 200 | Bir sesin konuÅŸma olarak kabul edilmesi iÃ§in gereken minimum sÃ¼re. |
| `min_silence_duration_ms`| 100 | KonuÅŸmanÄ±n bittiÄŸini varsaymak iÃ§in gereken minimum sessizlik sÃ¼resi. |
| `speech_prob_threshold` | 0.5 | Sesin konuÅŸma olma olasÄ±lÄ±ÄŸÄ± eÅŸiÄŸi. |

---

## 8. Interruption (Barge-in)

KullanÄ±cÄ±nÄ±n, asistan konuÅŸurken araya girmesini saÄŸlamak iÃ§in `MinWordsInterruptionStrategy` kullanÄ±lÄ±r. Bu strateji, kullanÄ±cÄ± belirli bir sayÄ±da kelime sÃ¶ylediÄŸinde TTS ses Ã§Ä±kÄ±ÅŸÄ±nÄ± anÄ±nda keser.

